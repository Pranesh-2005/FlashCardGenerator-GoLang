<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Flashcards AI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">
  
  <!-- All your existing icon links stay the same -->
  <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="48x48" href="icons/favicon-48x48.png">
  
  <!-- Apple Touch Icons -->
  <link rel="apple-touch-icon" sizes="57x57" href="icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="152x152" href="icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="167x167" href="icons/apple-icon-167x167.png">
  <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-icon-180x180.png">
  
  <!-- Android Chrome Icons -->
  <link rel="icon" type="image/png" sizes="96x96" href="icons/android-icon-96x96.png">
  <link rel="icon" type="image/png" sizes="128x128" href="icons/android-icon-128x128.png">
  <link rel="icon" type="image/png" sizes="144x144" href="icons/android-icon-144x144.png">
  <link rel="icon" type="image/png" sizes="192x192" href="icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="256x256" href="icons/android-icon-256x256.png">
  <link rel="icon" type="image/png" sizes="384x384" href="icons/android-icon-384x384.png">
  <link rel="icon" type="image/png" sizes="512x512" href="icons/android-icon-512x512.png">
  
  <!-- Microsoft Tile Icons -->
  <meta name="msapplication-TileImage" content="icons/ms-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#6366f1">
  <meta name="msapplication-square32x32logo" content="icons/ms-icon-32x32.png">
  <meta name="msapplication-square70x70logo" content="icons/ms-icon-70x70.png">
  <meta name="msapplication-square150x150logo" content="icons/ms-icon-150x150.png">
  <meta name="msapplication-wide310x150logo" content="icons/ms-icon-310x310.png">
  <meta name="msapplication-square310x310logo" content="icons/ms-icon-310x310.png">
  
  <!-- PWA Meta Tags -->
  <meta name="theme-color" content="#6366f1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="FlashCard AI">
  <meta name="description" content="Generate AI-powered flashcards for learning any topic">
  <meta name="keywords" content="flashcards, AI, learning, study, education">
  
  <!-- Open Graph Meta Tags -->
  <meta property="og:title" content="Flashcards AI - Smart Learning Tool">
  <meta property="og:description" content="Generate AI-powered flashcards for learning any topic">
  <meta property="og:image" content="icons/android-icon-512x512.png">
  <meta property="og:url" content="https://flash-cards-ai.vercel.app">
  <meta property="og:type" content="website">
  
  <!-- Twitter Card Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Flashcards AI - Smart Learning Tool">
  <meta name="twitter:description" content="Generate AI-powered flashcards for learning any topic">
  <meta name="twitter:image" content="icons/android-icon-512x512.png">

  <style>
    :root {
      /* Enhanced color palette */
      --bg-primary: #0f0f23;      /* Deep dark blue */
      --bg-secondary: #1a1a3a;    /* Lighter dark blue */
      --bg-card: #252547;         /* Card background */
      --text-primary: #ffffff;    /* Pure white */
      --text-secondary: #a5a5f0;  /* Light purple-blue */
      --text-muted: #7575a3;      /* Muted purple */
      --accent-primary: #6366f1;  /* Vibrant indigo */
      --accent-secondary: #8b5cf6; /* Purple accent */
      --accent-tertiary: #06b6d4; /* Cyan accent */
      --success: #10b981;         /* Green */
      --warning: #f59e0b;         /* Amber */
      --border: #3f3f65;          /* Border color */
      --shadow: rgba(99, 102, 241, 0.1);
      --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --gradient-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --gradient-tertiary: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      --radius: 16px;
      --radius-sm: 8px;
      --radius-lg: 24px;
    }

    /* Base */
    * { 
      box-sizing: border-box; 
      margin: 0;
      padding: 0;
    }
    
    html, body { 
      height: 100%; 
      scroll-behavior: smooth;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      font-weight: 400;
      -webkit-tap-highlight-color: transparent;
    }

    /* Layout */
    header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: rgba(15, 15, 35, 0.95);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border);
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    .brand {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 20px 0;
    }
    
    .brand-mark {
      width: 48px;
      height: 48px;
      border-radius: var(--radius-sm);
      background: var(--gradient-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      font-size: 18px;
      letter-spacing: -0.5px;
      box-shadow: 0 8px 32px var(--shadow);
    }
    
    .brand h1 {
      font-size: 28px;
      font-weight: 700;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: -0.5px;
    }

    /* Enhanced form panel */
    .panel {
      margin: 32px 0;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 32px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      position: relative;
      overflow: hidden;
    }
    
    .panel::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: var(--gradient-primary);
    }
    
    .panel h2 {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 24px;
      color: var(--text-primary);
      letter-spacing: -0.3px;
    }
    
    /* Enhanced grid layout with individual field controls */
    .grid {
      display: grid;
      gap: 20px;
      margin-bottom: 24px;
    }
    
    .grid-responsive {
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
    }
    
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    
    /* Individual field containers */
    .field-username,
    .field-topic {
      display: flex;
      flex-direction: column;
    }
    
    .field-count,
    .field-level {
      display: flex;
      flex-direction: column;
    }
    
    label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-secondary);
      margin-bottom: 8px;
      letter-spacing: 0.2px;
    }
    
    /* Base input styles */
    input, select {
      padding: 16px 20px;
      border: 2px solid var(--border);
      border-radius: var(--radius);
      background: var(--bg-card);
      color: var(--text-primary);
      font-size: 16px;
      font-weight: 400;
      outline: none;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    /* Individual field width controls */
    #username {
      width: 100%;
      min-width: 200px;
    }
    
    #topic {
      width: 100%;
      min-width: 250px;
    }
    
    #count {
      width: 100%;
      min-width: 80px;
      max-width: 120px;
    }
    
    #level {
      width: 100%;
      min-width: 140px;
    }
    
    /* Tablet and desktop layouts */
    @media (min-width: 768px) {
      .grid-responsive {
        display: grid;
        grid-template-columns: minmax(200px, 1fr) minmax(250px, 1.2fr) minmax(260px, 0.8fr);
        gap: 20px;
        align-items: end;
      }
      
      .form-row {
        display: flex;
        gap: 16px;
        align-items: end;
      }
      
      .form-row .field-count {
        flex: 0 0 120px;
      }
      
      .form-row .field-level {
        flex: 1 1 140px;
        min-width: 140px;
      }
      
      #username {
        min-width: 220px;
      }
      
      #topic {
        min-width: 280px;
      }
      
      #count {
        min-width: 80px;
        max-width: 100px;
      }
      
      #level {
        min-width: 150px;
      }
    }
    
    @media (min-width: 1024px) {
      .grid-responsive {
        grid-template-columns: minmax(250px, 1fr) minmax(300px, 1.3fr) minmax(300px, 0.9fr);
      }
      
      #username {
        min-width: 250px;
        max-width: 300px;
      }
      
      #topic {
        min-width: 300px;
        max-width: 400px;
      }
      
      #count {
        min-width: 80px;
        max-width: 100px;
      }
      
      #level {
        min-width: 160px;
        max-width: 200px;
      }
    }
    
    /* Mobile responsive */
    @media (max-width: 767px) {
      .grid-responsive {
        grid-template-columns: 1fr;
      }
      
      .form-row {
        grid-template-columns: 1fr;
        gap: 16px;
      }
      
      #username,
      #topic,
      #count,
      #level {
        width: 100%;
        min-width: auto;
        max-width: none;
      }
    }
    
    input:focus, select:focus {
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
      transform: translateY(-2px);
    }
    
    input::placeholder {
      color: var(--text-muted);
    }
    
    /* Enhanced buttons */
    .actions {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
    }
    
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 16px 32px;
      border: none;
      border-radius: var(--radius);
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      min-width: 140px;
      -webkit-tap-highlight-color: transparent;
    }
    
    .btn-primary {
      background: var(--gradient-primary);
      color: white;
      box-shadow: 0 8px 32px rgba(99, 102, 241, 0.3);
    }
    
    .btn-primary:hover,
    .btn-primary:active {
      transform: translateY(-3px);
      box-shadow: 0 12px 40px rgba(99, 102, 241, 0.4);
    }
    
    .btn-secondary {
      background: var(--bg-card);
      color: var(--text-primary);
      border: 2px solid var(--border);
    }
    
    .btn-secondary:hover,
    .btn-secondary:active {
      border-color: var(--accent-primary);
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
    }

    /* Status pills */
    .meta {
      margin: 24px 0;
      display: flex;
      gap: 16px;
      align-items: center;
      flex-wrap: wrap;
    }
    
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 999px;
      font-size: 14px;
      color: var(--text-secondary);
      font-weight: 500;
    }
    
    .pill-primary {
      background: rgba(99, 102, 241, 0.1);
      color: var(--accent-primary);
      border-color: rgba(99, 102, 241, 0.2);
    }

    /* Enhanced cards grid with masonry-like layout */
    .cards {
      display: grid;
      gap: 24px;
      margin-top: 32px;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      align-items: start;
    }
    
    @media (max-width: 640px) { 
      .cards { 
        grid-template-columns: 1fr;
        gap: 16px;
      }
    }

    /* DYNAMIC CARD SIZING: Enhanced flip cards with content-based sizing */
    .flip-card {
      perspective: 1000px;
      border: none;
      background: transparent;
      padding: 0;
      cursor: pointer;
      width: 100%;
      height: auto;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
      user-select: none;
    }
    
    .flip-inner {
      position: relative;
      width: 100%;
      min-height: 180px; /* Minimum height for very short content */
      height: auto; /* Allow dynamic height */
      transition: transform 0.8s;
      transform-style: preserve-3d;
    }
    
    /* FIXED: Use class instead of aria-pressed for more reliable flipping */
    .flip-card.flipped .flip-inner {
      transform: rotateY(180deg);
    }
    
    .side {
      position: absolute;
      width: 100%;
      min-height: 180px; /* Match flip-inner min-height */
      height: auto; /* Allow dynamic height */
      backface-visibility: hidden;
      -webkit-backface-visibility: hidden;
      padding: 20px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      border-radius: var(--radius-lg);
      border: 2px solid var(--border);
      transition: all 0.3s ease;
    }
    
    .front {
      background: var(--gradient-primary);
      color: white;
    }
    
    .back {
      background: var(--gradient-tertiary);
      color: white;
      transform: rotateY(180deg);
    }
    
    .q-title, .a-title {
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 1px;
      text-transform: uppercase;
      opacity: 0.8;
      margin-bottom: 12px;
      flex-shrink: 0;
    }
    
    .q-text, .a-text {
      font-size: 16px;
      font-weight: 500;
      line-height: 1.5;
      flex-grow: 1;
      display: flex;
      align-items: flex-start;
      text-align: left;
      word-wrap: break-word;
      overflow-wrap: break-word;
      hyphens: auto;
      margin-bottom: 16px; /* Add space before footer elements */
    }
    
    .index {
      font-size: 14px;
      font-weight: 600;
      opacity: 0.7;
      align-self: flex-end;
      background: rgba(255, 255, 255, 0.2);
      padding: 6px 12px;
      border-radius: 999px;
      flex-shrink: 0;
      margin-top: auto; /* Push to bottom */
    }
    
    .hint {
      font-size: 13px;
      opacity: 0.8;
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      flex-shrink: 0;
    }

    /* Empty state */
    .empty {
      grid-column: 1 / -1;
      margin: 48px 0;
      padding: 48px 32px;
      text-align: center;
      background: var(--bg-secondary);
      border: 2px dashed var(--border);
      border-radius: var(--radius-lg);
      color: var(--text-muted);
    }
    
    .empty h3 {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 12px;
      color: var(--text-secondary);
    }

    /* Loading states */
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
    }
    
    .loading {
      position: relative;
      color: transparent !important;
    }
    
    .loading::after {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      top: 50%;
      left: 50%;
      margin-left: -10px;
      margin-top: -10px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Responsive improvements */
    @media (max-width: 767px) {
      .container {
        padding: 0 16px;
      }
      
      .panel {
        padding: 24px 20px;
        margin: 20px 0;
      }
      
      .brand h1 {
        font-size: 24px;
      }
      
      .btn {
        min-width: auto;
        width: 100%;
        padding: 18px 24px;
      }
      
      .actions {
        flex-direction: column;
      }
      
      .side {
        padding: 16px; /* Smaller padding on mobile */
        min-height: 160px; /* Slightly smaller min-height on mobile */
      }
      
      .q-text, .a-text {
        font-size: 15px;
      }
      
      .flip-inner {
        min-height: 160px; /* Match side min-height */
      }
    }

    /* Very small mobile screens */
    @media (max-width: 480px) {
      .side {
        padding: 14px;
        min-height: 140px;
      }
      
      .flip-inner {
        min-height: 140px;
      }
      
      .q-text, .a-text {
        font-size: 14px;
        line-height: 1.4;
      }
    }

    /* Accessibility helpers */
    .sr-only {
      position: absolute !important;
      height: 1px; 
      width: 1px;
      overflow: hidden;
      clip: rect(1px,1px,1px,1px);
      white-space: nowrap; 
      border: 0; 
      padding: 0; 
      margin: -1px;
    }

    /* Focus indicators for accessibility */
    .flip-card:focus {
      outline: 2px solid var(--accent-primary);
      outline-offset: 4px;
    }
  </style>
</head>
<body>
  <header>
    <div class="container brand" role="banner" aria-label="Flashcards AI">
      <div class="brand-mark" aria-hidden="true">✨</div>
      <h1>Flashcards AI</h1>
    </div>
  </header>

  <main class="container" role="main">
    <section class="panel" aria-labelledby="generator-title">
      <h2 id="generator-title">✨ Create Smart Flashcards</h2>
      <div class="grid grid-responsive" role="form" aria-describedby="form-hint">
        <div class="field-username">
          <label for="username">👤 Username</label>
          <input id="username" placeholder="Enter your username" autocomplete="username" />
        </div>
        <div class="field-topic">
          <label for="topic">📚 Topic</label>
          <input id="topic" placeholder="What do you want to learn?" />
        </div>
        <div class="form-row">
          <div class="field-count">
            <label for="count">🎯 Cards</label>
            <input id="count" type="number" min="1" max="20" value="5" />
          </div>
          <div class="field-level">
            <label for="level">⚡ Level</label>
            <select id="level" aria-label="Difficulty level">
              <option value="beginner">🌱 Beginner</option>
              <option value="intermediate">🚀 Intermediate</option>
              <option value="expert">🔥 Expert</option>
            </select>
          </div>
        </div>
      </div>
      
      <div class="actions" role="group" aria-label="Actions">
        <button class="btn btn-primary" id="btn-generate">
          ✨ Generate Cards
        </button>
        <button class="btn btn-secondary" id="btn-load">
          📖 Load My Cards
        </button>
      </div>
      
      <div id="form-hint" class="meta">
        <span class="pill">💡 Tap any card to flip it</span>
        <span class="pill">⌨️ Use Space or Enter to flip</span>
      </div>
    </section>

    <section class="meta" aria-live="polite" aria-atomic="true">
      <div id="count-info" class="pill pill-primary">📊 0 cards generated</div>
    </section>

    <section id="cards" class="cards" aria-label="Flashcards list">
      <div class="empty" id="empty">
        <h3>🎯 Ready to Learn?</h3>
        <p>Generate AI-powered flashcards or load your existing collection to start studying!</p>
      </div>
    </section>
  </main>

  <script>
    const API_BASE = "https://lashardenerator-oang-pranesh-20059066-0se2a8uv.leapcell.dev";

    const btnGenerate = document.getElementById("btn-generate");
    const btnLoad = document.getElementById("btn-load");
    const cardsContainer = document.getElementById("cards");
    const countInfo = document.getElementById("count-info");
    const emptyState = document.getElementById("empty");

    btnGenerate.addEventListener("click", generate);
    btnLoad.addEventListener("click", load);

    function setLoading(btn, loading) {
      if (loading) {
        btn.disabled = true;
        btn.classList.add("loading");
      } else {
        btn.disabled = false;
        btn.classList.remove("loading");
      }
    }

    async function generate() {
      const username = document.getElementById("username").value.trim();
      const topic = document.getElementById("topic").value.trim();
      const count = parseInt(document.getElementById("count").value, 10) || 5;
      const level = document.getElementById("level").value;

      if (!username || !topic) { 
        alert("⚠️ Please enter both username and topic"); 
        return; 
      }

      setLoading(btnGenerate, true);

      try {
        // Create/ensure user exists
        await fetch(`${API_BASE}/user`, {
          method: "POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify({ username })
        });

        // Generate flashcards
        const res = await fetch(`${API_BASE}/flashcards`, {
          method: "POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify({ username, topic, count, level })
        });
        
        if (!res.ok) throw new Error('Failed to generate cards');
        
        const data = await res.json();
        render(data.flashcards);
      } catch (e) {
        console.error(e);
        alert("❌ Something went wrong generating flashcards. Please try again.");
      } finally {
        setLoading(btnGenerate, false);
      }
    }

    async function load() {
      const username = document.getElementById("username").value.trim();
      if (!username) { 
        alert("⚠️ Please enter your username"); 
        return; 
      }
      
      setLoading(btnLoad, true);
      
      try {
        const res = await fetch(`${API_BASE}/flashcards/${encodeURIComponent(username)}`);
        if (!res.ok) throw new Error('Failed to load cards');
        
        const data = await res.json();
        render(data);
      } catch (e) {
        console.error(e);
        alert("❌ Something went wrong loading your flashcards. Please try again.");
      } finally {
        setLoading(btnLoad, false);
      }
    }

    function createFlipCard(card, index) {
      console.log(`Creating flip card ${index + 1}:`, card);

      const wrapper = document.createElement("div");
      wrapper.className = "flip-card";
      wrapper.setAttribute("role", "button");
      wrapper.setAttribute("tabindex", "0");
      wrapper.setAttribute("aria-label", `Flashcard ${index + 1}. Click to flip.`);

      const inner = document.createElement("div");
      inner.className = "flip-inner";

      // Question side
      const front = document.createElement("div");
      front.className = "side front";
      
      const qTitle = document.createElement("div");
      qTitle.className = "q-title";
      qTitle.textContent = "Question";
      
      const qText = document.createElement("div");
      qText.className = "q-text";
      qText.textContent = card.question;
      
      const hint = document.createElement("div");
      hint.className = "hint";
      hint.textContent = "🔄 Tap to reveal answer";
      
      const idx = document.createElement("div");
      idx.className = "index";
      idx.textContent = `#${index + 1}`;

      front.appendChild(qTitle);
      front.appendChild(qText);
      front.appendChild(hint);
      front.appendChild(idx);

      // Answer side
      const back = document.createElement("div");
      back.className = "side back";
      
      const aTitle = document.createElement("div");
      aTitle.className = "a-title";
      aTitle.textContent = "Answer";
      
      const aText = document.createElement("div");
      aText.className = "a-text";
      aText.textContent = card.answer;
      
      const hint2 = document.createElement("div");
      hint2.className = "hint";
      hint2.textContent = "🔄 Tap to see question";

      back.appendChild(aTitle);
      back.appendChild(aText);
      back.appendChild(hint2);
      back.appendChild(idx.cloneNode(true));

      inner.appendChild(front);
      inner.appendChild(back);
      wrapper.appendChild(inner);

      // FIXED: Simplified flip interaction
      function toggleFlip(e) {
        console.log(`Flipping card ${index + 1}`);
        e.preventDefault();
        e.stopPropagation();
        
        wrapper.classList.toggle("flipped");
        
        const isFlipped = wrapper.classList.contains("flipped");
        wrapper.setAttribute("aria-label", 
          `Flashcard ${index + 1}. ${isFlipped ? "Showing answer. Click to see question." : "Showing question. Click to see answer."}`
        );
      }
      
      // Multiple event listeners for better compatibility
      wrapper.addEventListener("click", toggleFlip);
      wrapper.addEventListener("touchstart", function(e) {
        e.preventDefault();
      });
      wrapper.addEventListener("touchend", function(e) {
        e.preventDefault();
        toggleFlip(e);
      });
      
      // Keyboard support
      wrapper.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          toggleFlip(e);
        }
      });

      // DYNAMIC SIZING: Calculate and set dynamic height after content is rendered
      setTimeout(() => {
        // Temporarily make both sides visible to measure their natural height
        const originalTransform = inner.style.transform;
        const originalTransition = inner.style.transition;
        
        // Disable transition temporarily
        inner.style.transition = 'none';
        
        // Measure front side
        inner.style.transform = 'rotateY(0deg)';
        const frontHeight = front.scrollHeight;
        
        // Measure back side
        inner.style.transform = 'rotateY(180deg)';
        const backHeight = back.scrollHeight;
        
        // Calculate the maximum height needed
        const maxHeight = Math.max(frontHeight, backHeight);
        const finalHeight = Math.max(maxHeight, window.innerWidth <= 480 ? 140 : window.innerWidth <= 767 ? 160 : 180);
        
        // Set the calculated height
        inner.style.height = `${finalHeight}px`;
        front.style.height = `${finalHeight}px`;
        back.style.height = `${finalHeight}px`;
        
        // Restore original state
        inner.style.transform = originalTransform;
        inner.style.transition = originalTransition;
      }, 10);

      return wrapper;
    }

    function render(cards) {
      console.log("Rendering cards:", cards);
      cardsContainer.innerHTML = "";
      
      if (!cards || cards.length === 0) {
        countInfo.textContent = "📊 0 cards generated";
        emptyState.style.display = "";
        return;
      }
      
      emptyState.style.display = "none";

      cards.forEach((card, index) => {
        const cardEl = createFlipCard(card, index);
        cardsContainer.appendChild(cardEl);
      });

      countInfo.textContent = `📊 ${cards.length} card${cards.length > 1 ? "s" : ""} generated`;
    }
  </script>
</body>
</html>