<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Flashcards AI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      /* Enhanced color palette */
      --bg-primary: #0f0f23;      /* Deep dark blue */
      --bg-secondary: #1a1a3a;    /* Lighter dark blue */
      --bg-card: #252547;         /* Card background */
      --text-primary: #ffffff;    /* Pure white */
      --text-secondary: #a5a5f0;  /* Light purple-blue */
      --text-muted: #7575a3;      /* Muted purple */
      --accent-primary: #6366f1;  /* Vibrant indigo */
      --accent-secondary: #8b5cf6; /* Purple accent */
      --accent-tertiary: #06b6d4; /* Cyan accent */
      --success: #10b981;         /* Green */
      --warning: #f59e0b;         /* Amber */
      --border: #3f3f65;          /* Border color */
      --shadow: rgba(99, 102, 241, 0.1);
      --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --gradient-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --gradient-tertiary: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      --radius: 16px;
      --radius-sm: 8px;
      --radius-lg: 24px;
    }

    /* Base */
    * { 
      box-sizing: border-box; 
      margin: 0;
      padding: 0;
    }
    
    html, body { 
      height: 100%; 
      scroll-behavior: smooth;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      font-weight: 400;
    }

    /* Layout */
    header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: rgba(15, 15, 35, 0.95);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border);
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    .brand {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 20px 0;
    }
    
    .brand-mark {
      width: 48px;
      height: 48px;
      border-radius: var(--radius-sm);
      background: var(--gradient-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      font-size: 18px;
      letter-spacing: -0.5px;
      box-shadow: 0 8px 32px var(--shadow);
    }
    
    .brand h1 {
      font-size: 28px;
      font-weight: 700;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: -0.5px;
    }

    /* Enhanced form panel */
    .panel {
      margin: 32px 0;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 32px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      position: relative;
      overflow: hidden;
    }
    
    .panel::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: var(--gradient-primary);
    }
    
    .panel h2 {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 24px;
      color: var(--text-primary);
      letter-spacing: -0.3px;
    }
    
    .grid {
      display: grid;
      gap: 20px;
      margin-bottom: 24px;
    }
    
    @media (min-width: 768px) {
      .grid-responsive { 
        grid-template-columns: 2fr 2fr 1fr; 
      }
    }
    
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    
    @media (max-width: 767px) {
      .form-row { 
        grid-template-columns: 1fr; 
      }
    }
    
    label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-secondary);
      margin-bottom: 8px;
      letter-spacing: 0.2px;
    }
    
    input, select {
      width: 100%;
      padding: 16px 20px;
      border: 2px solid var(--border);
      border-radius: var(--radius);
      background: var(--bg-card);
      color: var(--text-primary);
      font-size: 16px;
      font-weight: 400;
      outline: none;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    input:focus, select:focus {
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
      transform: translateY(-2px);
    }
    
    input::placeholder {
      color: var(--text-muted);
    }
    
    /* Enhanced buttons */
    .actions {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
    }
    
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 16px 32px;
      border: none;
      border-radius: var(--radius);
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      min-width: 140px;
    }
    
    .btn-primary {
      background: var(--gradient-primary);
      color: white;
      box-shadow: 0 8px 32px rgba(99, 102, 241, 0.3);
    }
    
    .btn-primary:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 40px rgba(99, 102, 241, 0.4);
    }
    
    .btn-secondary {
      background: var(--bg-card);
      color: var(--text-primary);
      border: 2px solid var(--border);
    }
    
    .btn-secondary:hover {
      border-color: var(--accent-primary);
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
    }
    
    .btn:active {
      transform: translateY(0);
    }

    /* Status pills */
    .meta {
      margin: 24px 0;
      display: flex;
      gap: 16px;
      align-items: center;
      flex-wrap: wrap;
    }
    
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 999px;
      font-size: 14px;
      color: var(--text-secondary);
      font-weight: 500;
    }
    
    .pill-primary {
      background: rgba(99, 102, 241, 0.1);
      color: var(--accent-primary);
      border-color: rgba(99, 102, 241, 0.2);
    }

    /* Enhanced cards grid with masonry-like layout */
    .cards {
      display: grid;
      gap: 24px;
      margin-top: 32px;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      align-items: start;
    }
    
    @media (max-width: 640px) { 
      .cards { 
        grid-template-columns: 1fr;
      }
    }

    /* Enhanced flip cards with dynamic height */
    .flip-card {
      perspective: 1000px;
      border: none;
      background: none;
      padding: 0;
      cursor: pointer;
      width: 100%;
    }
    
    .flip-inner {
      position: relative;
      width: 100%;
      min-height: 200px;
      transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      transform-style: preserve-3d;
      border-radius: var(--radius-lg);
    }
    
    .flip-card[aria-pressed="true"] .flip-inner {
      transform: rotateY(180deg);
    }
    
    .side {
      position: absolute;
      inset: 0;
      backface-visibility: hidden;
      padding: 28px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      border-radius: var(--radius-lg);
      border: 2px solid var(--border);
      transition: all 0.3s ease;
      min-height: 200px;
    }
    
    .flip-card:hover .side {
      border-color: var(--accent-primary);
      transform: translateY(-4px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    }
    
    .front {
      background: var(--gradient-primary);
      color: white;
    }
    
    .back {
      transform: rotateY(180deg);
      background: var(--gradient-tertiary);
      color: white;
    }
    
    .q-title, .a-title {
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 1px;
      text-transform: uppercase;
      opacity: 0.8;
      margin-bottom: 12px;
      flex-shrink: 0;
    }
    
    .q-text, .a-text {
      font-size: 16px;
      font-weight: 500;
      line-height: 1.5;
      flex-grow: 1;
      display: flex;
      align-items: flex-start;
      text-align: left;
      word-wrap: break-word;
      overflow-wrap: break-word;
      hyphens: auto;
    }
    
    .index {
      font-size: 14px;
      font-weight: 600;
      opacity: 0.7;
      align-self: flex-end;
      background: rgba(255, 255, 255, 0.2);
      padding: 6px 12px;
      border-radius: 999px;
      flex-shrink: 0;
      margin-top: 16px;
    }
    
    .hint {
      font-size: 13px;
      opacity: 0.8;
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      flex-shrink: 0;
    }

    /* Empty state */
    .empty {
      grid-column: 1 / -1;
      margin: 48px 0;
      padding: 48px 32px;
      text-align: center;
      background: var(--bg-secondary);
      border: 2px dashed var(--border);
      border-radius: var(--radius-lg);
      color: var(--text-muted);
    }
    
    .empty h3 {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 12px;
      color: var(--text-secondary);
    }

    /* Loading states */
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
    }
    
    .loading {
      position: relative;
      color: transparent !important;
    }
    
    .loading::after {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      top: 50%;
      left: 50%;
      margin-left: -10px;
      margin-top: -10px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Responsive improvements */
    @media (max-width: 767px) {
      .container {
        padding: 0 16px;
      }
      
      .panel {
        padding: 24px 20px;
        margin: 20px 0;
      }
      
      .brand h1 {
        font-size: 24px;
      }
      
      .btn {
        min-width: auto;
        width: 100%;
      }
      
      .actions {
        flex-direction: column;
      }
      
      .cards {
        grid-template-columns: 1fr !important;
      }
      
      .side {
        padding: 20px;
      }
      
      .q-text, .a-text {
        font-size: 15px;
      }
    }

    /* Accessibility helpers */
    .sr-only {
      position: absolute !important;
      height: 1px; 
      width: 1px;
      overflow: hidden;
      clip: rect(1px,1px,1px,1px);
      white-space: nowrap; 
      border: 0; 
      padding: 0; 
      margin: -1px;
    }
  </style>
</head>
<body>
  <header>
    <div class="container brand" role="banner" aria-label="Flashcards AI">
      <div class="brand-mark" aria-hidden="true">✨</div>
      <h1>Flashcards AI</h1>
    </div>
  </header>

  <main class="container" role="main">
    <section class="panel" aria-labelledby="generator-title">
      <h2 id="generator-title">✨ Create Smart Flashcards</h2>
      <div class="grid grid-responsive" role="form" aria-describedby="form-hint">
        <div>
          <label for="username">👤 Username</label>
          <input id="username" placeholder="Enter your username" autocomplete="username" />
        </div>
        <div>
          <label for="topic">📚 Topic</label>
          <input id="topic" placeholder="What do you want to learn?" />
        </div>
        <div class="form-row">
          <div>
            <label for="count">🎯 Cards</label>
            <input id="count" type="number" min="1" max="20" value="5" />
          </div>
          <div>
            <label for="level">⚡ Level</label>
            <select id="level" aria-label="Difficulty level">
              <option value="beginner">🌱 Beginner</option>
              <option value="intermediate">🚀 Intermediate</option>
              <option value="expert">🔥 Expert</option>
            </select>
          </div>
        </div>
      </div>
      
      <div class="actions" role="group" aria-label="Actions">
        <button class="btn btn-primary" id="btn-generate">
          ✨ Generate Cards
        </button>
        <button class="btn btn-secondary" id="btn-load">
          📖 Load My Cards
        </button>
      </div>
      
      <div id="form-hint" class="meta">
        <span class="pill">💡 Click any card to flip it</span>
        <span class="pill">⌨️ Use Space or Enter to flip</span>
      </div>
    </section>

    <section class="meta" aria-live="polite" aria-atomic="true">
      <div id="count-info" class="pill pill-primary">📊 0 cards generated</div>
    </section>

    <section id="cards" class="cards" aria-label="Flashcards list">
      <div class="empty" id="empty">
        <h3>🎯 Ready to Learn?</h3>
        <p>Generate AI-powered flashcards or load your existing collection to start studying!</p>
      </div>
    </section>
  </main>

  <script>
    const API_BASE = "https://goflashcardbackend.onrender.com";

    const btnGenerate = document.getElementById("btn-generate");
    const btnLoad = document.getElementById("btn-load");
    const cardsContainer = document.getElementById("cards");
    const countInfo = document.getElementById("count-info");
    const emptyState = document.getElementById("empty");

    btnGenerate.addEventListener("click", generate);
    btnLoad.addEventListener("click", load);

    function setLoading(btn, loading) {
      if (loading) {
        btn.disabled = true;
        btn.classList.add("loading");
      } else {
        btn.disabled = false;
        btn.classList.remove("loading");
      }
    }

    async function generate() {
      const username = document.getElementById("username").value.trim();
      const topic = document.getElementById("topic").value.trim();
      const count = parseInt(document.getElementById("count").value, 10) || 5;
      const level = document.getElementById("level").value;

      if (!username || !topic) { 
        alert("⚠️ Please enter both username and topic"); 
        return; 
      }

      setLoading(btnGenerate, true);

      try {
        // Create/ensure user exists
        await fetch(`${API_BASE}/user`, {
          method: "POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify({ username })
        });

        // Generate flashcards
        const res = await fetch(`${API_BASE}/flashcards`, {
          method: "POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify({ username, topic, count, level })
        });
        
        if (!res.ok) throw new Error('Failed to generate cards');
        
        const data = await res.json();
        render(data.flashcards);
      } catch (e) {
        console.error(e);
        alert("❌ Something went wrong generating flashcards. Please try again.");
      } finally {
        setLoading(btnGenerate, false);
      }
    }

    async function load() {
      const username = document.getElementById("username").value.trim();
      if (!username) { 
        alert("⚠️ Please enter your username"); 
        return; 
      }
      
      setLoading(btnLoad, true);
      
      try {
        const res = await fetch(`${API_BASE}/flashcards/${encodeURIComponent(username)}`);
        if (!res.ok) throw new Error('Failed to load cards');
        
        const data = await res.json();
        render(data);
      } catch (e) {
        console.error(e);
        alert("❌ Something went wrong loading your flashcards. Please try again.");
      } finally {
        setLoading(btnLoad, false);
      }
    }

    function createFlipCard(card, index) {
      const wrapper = document.createElement("button");
      wrapper.type = "button";
      wrapper.className = "flip-card";
      wrapper.setAttribute("aria-pressed", "false");
      wrapper.setAttribute("aria-label", `Flashcard ${index + 1}. Press to flip.`);

      const inner = document.createElement("div");
      inner.className = "flip-inner";

      // Question side
      const front = document.createElement("div");
      front.className = "side front";
      
      const qTitle = document.createElement("div");
      qTitle.className = "q-title";
      qTitle.textContent = "Question";
      
      const qText = document.createElement("div");
      qText.className = "q-text";
      qText.textContent = card.question;
      
      const hint = document.createElement("div");
      hint.className = "hint";
      hint.textContent = "🔄 Click to reveal answer";
      
      const idx = document.createElement("div");
      idx.className = "index";
      idx.textContent = `#${index + 1}`;

      front.appendChild(qTitle);
      front.appendChild(qText);
      front.appendChild(hint);
      front.appendChild(idx);

      // Answer side
      const back = document.createElement("div");
      back.className = "side back";
      
      const aTitle = document.createElement("div");
      aTitle.className = "a-title";
      aTitle.textContent = "Answer";
      
      const aText = document.createElement("div");
      aText.className = "a-text";
      aText.textContent = card.answer;
      
      const hint2 = document.createElement("div");
      hint2.className = "hint";
      hint2.textContent = "🔄 Click to see question";

      back.appendChild(aTitle);
      back.appendChild(aText);
      back.appendChild(hint2);
      back.appendChild(idx.cloneNode(true));

      inner.appendChild(front);
      inner.appendChild(back);
      wrapper.appendChild(inner);

      // Flip interaction
      function toggleFlip() {
        const pressed = wrapper.getAttribute("aria-pressed") === "true";
        wrapper.setAttribute("aria-pressed", String(!pressed));
      }
      
      wrapper.addEventListener("click", toggleFlip);
      wrapper.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          toggleFlip();
        }
      });

      // Calculate dynamic height after content is rendered
      setTimeout(() => {
        const frontHeight = front.scrollHeight;
        const backHeight = back.scrollHeight;
        const maxHeight = Math.max(frontHeight, backHeight, 200);
        
        inner.style.height = `${maxHeight}px`;
        front.style.height = `${maxHeight}px`;
        back.style.height = `${maxHeight}px`;
      }, 10);

      return wrapper;
    }

    function render(cards) {
      cardsContainer.innerHTML = "";
      
      if (!cards || cards.length === 0) {
        countInfo.textContent = "📊 0 cards generated";
        emptyState.style.display = "";
        return;
      }
      
      emptyState.style.display = "none";

      cards.forEach((card, index) => {
        const cardEl = createFlipCard(card, index);
        cardsContainer.appendChild(cardEl);
      });

      countInfo.textContent = `📊 ${cards.length} card${cards.length > 1 ? "s" : ""} generated`;
    }
  </script>
</body>
</html>